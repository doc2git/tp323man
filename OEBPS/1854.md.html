<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta http-equiv="Default-Style" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" type="text/css" href="styles.css"/>
    <title>Test Book</title>
  </head>
  <body class="book-content">
    <p>默认的数据库驱动位于<code>Think\Db\Driver</code>命名空间下面，驱动类必须继承<code>Think\Db</code>类，每个数据库驱动必须要实现的接口方法包括（具体参数可以参考现有的数据库驱动类库）： </p>
    <table>
      <thead>
        <tr>
          <th>驱动方法</th>
          <th>方法说明</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>架构方法</td>
          <td>__construct($config='')</td>
        </tr>
        <tr>
          <td>数据库连接方法</td>
          <td>connect($config='',$linkNum=0,$force=false)</td>
        </tr>
        <tr>
          <td>释放查询方法</td>
          <td>free()</td>
        </tr>
        <tr>
          <td>查询操作方法</td>
          <td>query($str)</td>
        </tr>
        <tr>
          <td>执行操作方法</td>
          <td>execute($str)</td>
        </tr>
        <tr>
          <td>开启事务方法</td>
          <td>startTrans()</td>
        </tr>
        <tr>
          <td>事务提交方法</td>
          <td>commit()</td>
        </tr>
        <tr>
          <td>事务回滚方法</td>
          <td>rollback()</td>
        </tr>
        <tr>
          <td>获取查询数据方法</td>
          <td>getAll()</td>
        </tr>
        <tr>
          <td>获取字段信息方法</td>
          <td>getFields($tableName)</td>
        </tr>
        <tr>
          <td>获取数据库的表</td>
          <td>getTables($dbName='')</td>
        </tr>
        <tr>
          <td>关闭数据库方法</td>
          <td>close()</td>
        </tr>
        <tr>
          <td>获取错误信息方法</td>
          <td>error()</td>
        </tr>
        <tr>
          <td>SQL安全过滤方法</td>
          <td>escapeString($str)</td>
        </tr>
      </tbody>
    </table>
    <p>数据库的CURD接口方法（通常这些方法无需重新定义） </p>
    <table>
      <thead>
        <tr>
          <th>方法</th>
          <th>说明</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>写入</td>
          <td>insert($data,$options=array(),$replace=false)</td>
        </tr>
        <tr>
          <td>更新</td>
          <td>update($data,$options)</td>
        </tr>
        <tr>
          <td>删除</td>
          <td>delete($options=array())</td>
        </tr>
        <tr>
          <td>查询</td>
          <td>select($options=array())</td>
        </tr>
      </tbody>
    </table>
    <p>介于不同数据库的查询方法存在区别，所以经常需要对查询的语句进行重新定义，这就需要修改针对查询的<code>selectSql</code>属性。该属性定义了当前数据库驱动的查询表达式，默认的定义是：</p>
    <pre>
      <code>'SELECT%DISTINCT% %FIELD% FROM %TABLE%%JOIN%%WHERE%%GROUP%%HAVING%%ORDER%%LIMIT% %UNION%'</code>
    </pre>
    <p>驱动可以更改或者删除个别查询定义，或者更改某个替换字符串的解析方法，这些方法包括： </p>
    <table>
      <thead>
        <tr>
          <th>方法名</th>
          <th>说明</th>
          <th>对应</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>parseTable</td>
          <td>数据库表名解析</td>
          <td>%TABLE%</td>
        </tr>
        <tr>
          <td>parseWhere</td>
          <td>数据库查询条件解析</td>
          <td>%WHERE%</td>
        </tr>
        <tr>
          <td>parseLimit</td>
          <td>数据库查询Limit解析</td>
          <td>%LIMIT%</td>
        </tr>
        <tr>
          <td>parseJoin</td>
          <td>数据库JOIN查询解析</td>
          <td>%JOIN%</td>
        </tr>
        <tr>
          <td>parseOrder</td>
          <td>数据库查询排序解析</td>
          <td>%ORDER%</td>
        </tr>
        <tr>
          <td>parseGroup</td>
          <td>数据库group查询解析</td>
          <td>%GROUP%</td>
        </tr>
        <tr>
          <td>parseHaving</td>
          <td>数据库having解析</td>
          <td>%HAVING%</td>
        </tr>
        <tr>
          <td>parseDistinct</td>
          <td>数据库distinct解析</td>
          <td>%DISTINCT%</td>
        </tr>
        <tr>
          <td>parseUnion</td>
          <td>数据库union解析</td>
          <td>%UNION%</td>
        </tr>
        <tr>
          <td>parseField</td>
          <td>数据库字段解析</td>
          <td>%FIELD%</td>
        </tr>
      </tbody>
    </table>
    <p>驱动的其他方法根据自身驱动需要和特性进行添加，例如，有些数据库的特殊性，需要覆盖父类Db类中的解析和过滤方法，包括：</p>
    <table>
      <thead>
        <tr>
          <th>方法名</th>
          <th>说明</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>parseKey</td>
          <td>数据库字段名解析</td>
        </tr>
        <tr>
          <td>parseValue</td>
          <td>数据库字段值解析</td>
        </tr>
        <tr>
          <td>parseSet</td>
          <td>数据库set分析</td>
        </tr>
        <tr>
          <td>parseLock</td>
          <td>数据库锁机制</td>
        </tr>
      </tbody>
    </table>
    <p>定义了驱动扩展后，需要使用的时候，设置相应的数据库类型即可：</p>
    <pre>
      <code>'DB_TYPE'=&gt;'odbc', // 数据库类型配置不区分大小写</code>
    </pre>
  </body>
</html>
